-- Combat Power Ultra Booster - Fixed Version
-- Menggunakan remote asli dari game

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- Configuration
local Config = {
    TrainMultiplier = 1000000000000, -- 1 Triliun per train
    AutoTrain = false,
    UseBuffItems = false,
    TrainSpeed = 0.5,
}

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TitleBar = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")
local MinimizeButton = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")

ScreenGui.Name = "CombatBooster"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game:GetService("CoreGui")

MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 420, 0, 480)
MainFrame.Position = UDim2.new(0.5, -210, 0.5, -240)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 2
MainFrame.BorderColor3 = Color3.fromRGB(60, 60, 60)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.Text = "âš¡ Combat Power Booster"
Title.TextColor3 = Color3.fromRGB(255, 215, 0)
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TitleBar

CloseButton.Size = UDim2.new(0, 35, 0, 35)
CloseButton.Position = UDim2.new(1, -40, 0, 2.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

MinimizeButton.Size = UDim2.new(0, 35, 0, 35)
MinimizeButton.Position = UDim2.new(1, -80, 0, 2.5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(40, 167, 69)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Text = "âˆ’"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 18
MinimizeButton.Parent = TitleBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeButton

ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

local function CreateButton(text, yPos, color)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, 0, 0, 35)
    btn.Position = UDim2.new(0, 0, 0, yPos)
    btn.BackgroundColor3 = color
    btn.Font = Enum.Font.GothamBold
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 13
    btn.Parent = ContentFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = btn
    
    return btn
end

local function CreateLabel(text, yPos)
    local lbl = Instance.new("TextLabel")
    lbl.Size = UDim2.new(1, 0, 0, 30)
    lbl.Position = UDim2.new(0, 0, 0, yPos)
    lbl.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    lbl.Font = Enum.Font.Gotham
    lbl.Text = text
    lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
    lbl.TextSize = 12
    lbl.TextXAlignment = Enum.TextXAlignment.Left
    lbl.Parent = ContentFrame
    
    local padding = Instance.new("UIPadding")
    padding.PaddingLeft = UDim.new(0, 10)
    padding.Parent = lbl
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 6)
    corner.Parent = lbl
    
    return lbl
end

local StatusLabel = CreateLabel("Status: Ready", 0)
local InfoLabel = CreateLabel("Multiplier: 1T per train", 35)

local MultiplierInput = Instance.new("TextBox")
MultiplierInput.Size = UDim2.new(1, 0, 0, 35)
MultiplierInput.Position = UDim2.new(0, 0, 0, 75)
MultiplierInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MultiplierInput.Font = Enum.Font.Gotham
MultiplierInput.Text = "1000000000000"
MultiplierInput.PlaceholderText = "Enter multiplier (1000000000000 = 1T)"
MultiplierInput.TextColor3 = Color3.fromRGB(255, 255, 255)
MultiplierInput.TextSize = 12
MultiplierInput.Parent = ContentFrame

local InputCorner = Instance.new("UICorner")
InputCorner.CornerRadius = UDim.new(0, 6)
InputCorner.Parent = MultiplierInput

local AutoTrainBtn = CreateButton("ðŸ”„ Auto Train: OFF", 120, Color3.fromRGB(108, 117, 125))
local UseBuffBtn = CreateButton("ðŸ’Š Use Buff Items: OFF", 165, Color3.fromRGB(111, 66, 193))
local BoostArmsBtn = CreateButton("ðŸ’ª Boost Arms (Item18)", 210, Color3.fromRGB(220, 53, 69))
local BoostLegsBtn = CreateButton("ðŸ¦µ Boost Legs (Item20)", 255, Color3.fromRGB(40, 167, 69))
local BoostBackBtn = CreateButton("ðŸŽ’ Boost Back (Item19)", 300, Color3.fromRGB(255, 193, 7))
local BoostAgilityBtn = CreateButton("âš¡ Boost Agility (Item21)", 345, Color3.fromRGB(23, 162, 184))
local BoostAllBtn = CreateButton("ðŸš€ BOOST ALL NOW", 390, Color3.fromRGB(255, 87, 34))

-- Format angka besar
local function FormatNumber(num)
    if num >= 1e15 then return string.format("%.2fQ", num / 1e15)
    elseif num >= 1e12 then return string.format("%.2fT", num / 1e12)
    elseif num >= 1e9 then return string.format("%.2fB", num / 1e9)
    elseif num >= 1e6 then return string.format("%.2fM", num / 1e6)
    else return tostring(math.floor(num)) end
end

-- Fungsi training dengan hook ke remote server
local function BoostTrainingValue(trainType, itemId)
    local multiplier = tonumber(MultiplierInput.Text) or Config.TrainMultiplier
    
    pcall(function()
        -- Hook ApplyStationaryTrain
        local ApplyStationaryTrain = ReplicatedStorage.TrainEquipment.Remote.ApplyStationaryTrain
        local oldFunc = ApplyStationaryTrain.InvokeServer
        
        ApplyStationaryTrain.InvokeServer = function(...)
            local args = {...}
            return oldFunc(unpack(args))
        end
        
        -- Fire training dengan nilai boost
        local TrainSpeedHasChanged = ReplicatedStorage.TrainSystem.Remote.TrainSpeedHasChanged
        TrainSpeedHasChanged:FireServer(trainType)
        
        -- Apply training dengan multiplier
        local PlayerTrainValueHasChanged = ReplicatedStorage.TrainsSystem.Remote.PlayerTrainValueHasChanged
        if PlayerTrainValueHasChanged then
            local currentValue = multiplier * 18 -- Base 18 per train
            firesignal(PlayerTrainValueHasChanged.OnClientEvent, LocalPlayer, trainType, currentValue, 0)
        end
        
        -- Gunakan buff item jika diaktifkan
        if Config.UseBuffItems and itemId then
            local TryOperatingItem = ReplicatedStorage.PlayerItemBackpack.Remote.TryOperatingItemByPlayer
            TryOperatingItem:InvokeServer({
                GridInfo = {Id = itemId, Num = 1},
                GridIndex = "401"
            }, itemId, 1, {
                Operation = "UseItem",
                PointingOperation = "UseSingleBuffConsum"
            })
        end
        
        StatusLabel.Text = "Status: Boosted " .. (trainType == 1 and "Arms" or trainType == 2 and "Legs" or trainType == 3 and "Back" or "Agility")
    end)
end

-- Auto train loop
local AutoTrainActive = false
spawn(function()
    while true do
        wait(Config.TrainSpeed)
        if AutoTrainActive then
            BoostTrainingValue(1, 18) -- Arms
            wait(0.1)
            BoostTrainingValue(2, 20) -- Legs
            wait(0.1)
            BoostTrainingValue(3, 19) -- Back
            wait(0.1)
            BoostTrainingValue(4, 21) -- Agility
            wait(0.1)
        end
    end
end)

-- Button handlers
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

MinimizeButton.MouseButton1Click:Connect(function()
    ContentFrame.Visible = not ContentFrame.Visible
    MainFrame.Size = ContentFrame.Visible and UDim2.new(0, 420, 0, 480) or UDim2.new(0, 420, 0, 40)
end)

AutoTrainBtn.MouseButton1Click:Connect(function()
    Config.AutoTrain = not Config.AutoTrain
    AutoTrainActive = Config.AutoTrain
    AutoTrainBtn.Text = "ðŸ”„ Auto Train: " .. (Config.AutoTrain and "ON" or "OFF")
    AutoTrainBtn.BackgroundColor3 = Config.AutoTrain and Color3.fromRGB(40, 167, 69) or Color3.fromRGB(108, 117, 125)
end)

UseBuffBtn.MouseButton1Click:Connect(function()
    Config.UseBuffItems = not Config.UseBuffItems
    UseBuffBtn.Text = "ðŸ’Š Use Buff Items: " .. (Config.UseBuffItems and "ON" or "OFF")
    UseBuffBtn.BackgroundColor3 = Config.UseBuffItems and Color3.fromRGB(138, 43, 226) or Color3.fromRGB(111, 66, 193)
end)

BoostArmsBtn.MouseButton1Click:Connect(function() BoostTrainingValue(1, 18) end)
BoostLegsBtn.MouseButton1Click:Connect(function() BoostTrainingValue(2, 20) end)
BoostBackBtn.MouseButton1Click:Connect(function() BoostTrainingValue(3, 19) end)
BoostAgilityBtn.MouseButton1Click:Connect(function() BoostTrainingValue(4, 21) end)

BoostAllBtn.MouseButton1Click:Connect(function()
    StatusLabel.Text = "Status: Boosting ALL..."
    BoostTrainingValue(1, 18)
    wait(0.1)
    BoostTrainingValue(2, 20)
    wait(0.1)
    BoostTrainingValue(3, 19)
    wait(0.1)
    BoostTrainingValue(4, 21)
    StatusLabel.Text = "Status: ALL Boosted!"
end)

MultiplierInput.FocusLost:Connect(function()
    local val = tonumber(MultiplierInput.Text)
    if val and val > 0 then
        Config.TrainMultiplier = val
        InfoLabel.Text = "Multiplier: " .. FormatNumber(val) .. " per train"
    else
        MultiplierInput.Text = tostring(Config.TrainMultiplier)
    end
end)

print("âœ… Combat Power Booster loaded!")
print("ðŸ“Œ Set multiplier, enable features, then click BOOST ALL or Auto Train")
StatusLabel.Text = "Status: Script Loaded Successfully!"
